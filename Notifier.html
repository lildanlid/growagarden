<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grow a Garden Stock Monitor</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f0f0; margin: 0; padding: 20px; }
h1 { text-align: center; }
.category { margin-bottom: 30px; }
.category h2 { background: #474951; color: #fff; padding: 10px; border-radius: 5px; }
.items { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
.item { background: #fff; padding: 10px; border-radius: 5px; width: 150px; text-align: center; box-shadow: 0 0 5px rgba(0,0,0,0.1); transition: 0.3s; }
.item img { width: 80px; height: 80px; object-fit: contain; }
.item.out-of-stock { opacity: 0.4; }
.quantity { font-weight: bold; margin-top: 5px; }
#notifications { margin-bottom: 20px; padding: 10px; background: #fff; border-radius: 5px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
#notifications h2 { margin-top: 0; }
.checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; }
.checkbox-group label { display: flex; align-items: center; gap: 5px; background: #eee; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
.checkbox-group input { cursor: pointer; }
</style>
</head>
<body>
<h1>Grow a Garden Stock Monitor</h1>

<div id="notifications">
  <h2>Select items for notifications:</h2>
  <div>
    <strong>Seeds:</strong>
    <div class="checkbox-group" id="seed-notifications"></div>
  </div>
  <div>
    <strong>Gears:</strong>
    <div class="checkbox-group" id="gear-notifications"></div>
  </div>
  <div>
    <strong>Eggs:</strong>
    <div class="checkbox-group" id="egg-notifications"></div>
  </div>
</div>

<div id="stock"></div>

<script>
const API_URL = 'https://api.joshlei.com/v2/growagarden/stock';
const API_KEY = 'js_c5d322d0652bc477f50348450bb2c6fe4f4d767042b2b0facb69b074c3d46f46';

const SEEDS = ["Carrot", "Strawberry", "Blueberry", "Tomato", "Daffodil", "Watermelon", "Pumpkin", "Apple", "Bamboo", "Coconut", "Cactus", "Dragon Fruit", "Mango", "Grape", "Mushroom", "Pepper", "Cacao", "Beanstalk", "Ember lily", "Sugar Apple", "Burning Bud", "Giant Pinecone", "Elder Strawberry","Romanesco"];
const GEARS = ["Watering Can", "Trowel", "Recall Wrench", "Basic Sprinkler", "Advanced Sprinkler", "Medium Toy", "Medium Treat", "Godly Sprinkler", "Magnifying Glass", "Tanning Mirror", "Master Sprinkler", "Cleaning Spray", "Favorite Tool", "Harvest Tool", "Friendship Pot", "Levelup Lolipop"];
const EGGS = ["Common Egg", "Common Summer Egg", "Rare Summer Egg", "Mythical Egg", "Paradise Egg", "Bug Egg"];

// Keep track of selected notification items
let selectedNotifications = { seeds: new Set(), gears: new Set(), eggs: new Set() };

// Populate checkboxes for notification selection
function createCheckboxes() {
    const seedDiv = document.getElementById('seed-notifications');
    SEEDS.forEach(name => {
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" value="${name}"> ${name}`;
        seedDiv.appendChild(label);
        label.querySelector('input').addEventListener('change', e => {
            e.target.checked ? selectedNotifications.seeds.add(name) : selectedNotifications.seeds.delete(name);
        });
    });

    const gearDiv = document.getElementById('gear-notifications');
    GEARS.forEach(name => {
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" value="${name}"> ${name}`;
        gearDiv.appendChild(label);
        label.querySelector('input').addEventListener('change', e => {
            e.target.checked ? selectedNotifications.gears.add(name) : selectedNotifications.gears.delete(name);
        });
    });

    const eggDiv = document.getElementById('egg-notifications');
    EGGS.forEach(name => {
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" value="${name}"> ${name}`;
        eggDiv.appendChild(label);
        label.querySelector('input').addEventListener('change', e => {
            e.target.checked ? selectedNotifications.eggs.add(name) : selectedNotifications.eggs.delete(name);
        });
    });
}

// Fetch stock data and display
async function fetchStock() {
    try {
        const res = await fetch(API_URL, {
            headers: { 'accept': 'application/json', 'jstudio-key': API_KEY }
        });
        const data = await res.json();
        displayStock(data);
        checkNotifications(data);
    } catch (err) {
        console.error('Error fetching stock:', err);
    }
}

// Display all stock items
function displayStock(data) {
    const stockDiv = document.getElementById('stock');
    stockDiv.innerHTML = '';
    const categories = [
        {name: 'Seeds', items: data.seed_stock, key: 'seeds'},
        {name: 'Gears', items: data.gear_stock, key: 'gears'},
        {name: 'Eggs', items: data.egg_stock, key: 'eggs'},
        {name: 'Cosmetics', items: data.cosmetic_stock},
        {name: 'Event Shop', items: data.eventshop_stock}
    ];

    categories.forEach(cat => {
        const catDiv = document.createElement('div');
        catDiv.className = 'category';
        catDiv.innerHTML = `<h2>${cat.name}</h2>`;
        const itemsDiv = document.createElement('div');
        itemsDiv.className = 'items';

        cat.items.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item';
            if (item.quantity === 0) itemDiv.classList.add('out-of-stock');
            itemDiv.innerHTML = `
                <img src="${item.icon}" alt="${item.display_name}">
                <div>${item.display_name}</div>
                <div class="quantity">Qty: ${item.quantity}</div>
            `;
            itemsDiv.appendChild(itemDiv);
        });

        catDiv.appendChild(itemsDiv);
        stockDiv.appendChild(catDiv);
    });
}

// Trigger notifications only for selected items
function checkNotifications(data) {
    const allItems = [
        {items: data.seed_stock, type: 'seeds'},
        {items: data.gear_stock, type: 'gears'},
        {items: data.egg_stock, type: 'eggs'}
    ];

    allItems.forEach(group => {
        group.items.forEach(item => {
            if (item.quantity > 0 && selectedNotifications[group.type].has(item.display_name)) {
                notify(item.display_name, item.quantity);
            }
        });
    });
}

// Browser notification
function notify(name, qty) {
    if (!("Notification" in window)) return;
    if (Notification.permission === "granted") {
        new Notification(`${name} in stock!`, { body: `Quantity: ${qty}` });
    } else if (Notification.permission !== "denied") {
        Notification.requestPermission().then(permission => {
            if (permission === "granted") new Notification(`${name} in stock!`, { body: `Quantity: ${qty}` });
        });
    }
}

// Initialize
createCheckboxes();
fetchStock();
setInterval(fetchStock, 990);
</script>
</body>
</html>
