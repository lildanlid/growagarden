<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grow a Garden Stock Monitor</title>
<style>
:root {
  --bg: #f0f0f0;
  --panel: #fff;
  --fg: #222;
  --accent: #8dcf91;
  --header: #474951;
}
body { 
  font-family: Arial, sans-serif; background: var(--bg); margin: 0; 
  color: var(--fg); padding: 0;
  transition: background 0.3s, color 0.3s;
}
body.dark {
  --bg: #232323; --panel: #303136; --fg: #f8f8f8; --header: #23232c;
}
h1 { text-align: center; margin:18px 0 8px; }
.topbar {
  display:flex; align-items:center; justify-content:space-between; padding:16px 20px 0 20px;
}
.toggle-btn {
  background: var(--panel); border: none; border-radius: 6px;
  font-size: 1.1em; color: var(--fg); cursor: pointer;
  box-shadow: 0 2px 8px #0001; transition: background .3s, color .3s;
  padding: 8px 14px;
  margin-right: 10px;
}
#loaderBg {
  position:fixed; inset:0; background:var(--bg); display:flex; align-items:center;
  justify-content:center; z-index:9999; animation:fadein 1s;
}
.loader {
  width:60px; height:60px; border-radius:100%; border:8px solid #bbb3;
  border-top:8px solid var(--accent); animation:spin 1s linear infinite;
}
@keyframes spin {to{transform:rotate(360deg);}}
@keyframes fadein {from{opacity:0;}to{opacity:1;}}
#notifSide {
  position: fixed; top: 0; right: -370px; height: 100%; width: 330px;
  background: var(--panel); box-shadow: -2px 0 24px #0004; z-index: 8000;
  transition: right 0.45s cubic-bezier(.24,.69,.27,1.01), background .3s; padding: 0;
  display:flex; flex-direction:column;
}
#notifSide.open { right: 0;}
#notifSideHeader { display:flex; align-items:center; justify-content:space-between; padding:18px 23px 7px 23px;}
#notifItems { padding:0 25px; overflow-y:auto; flex:1; }
.notifEntry { display:flex; gap:9px; align-items:center; margin:13px 0; }
.notifEntry img { width:30px; height:30px; border-radius:8px; }
.notifEntry .notifLast { margin-left:auto; font-size:0.95em; opacity:0.7;}
.notifEntry .notifStatus {margin-right:7px;}
.cat {
  margin:10px 0 26px;
  background: var(--panel);
  border-radius: 7px; box-shadow:0 0 7px #0001;
  transition: background .3s;
  overflow:hidden;
}
.catHeader {
  display:flex; align-items:center; justify-content:space-between;
  cursor:pointer; padding:13px 20px; background: var(--header); color:#fff;
  font-size: 1.12em; font-weight: 600; user-select: none;
  transition: background .3s, color .3s;
}
.catHeader i { font-style:normal; transition: transform .35s;}
.cat.open .catHeader i { transform: rotate(180deg);}
.catContent {
  max-height: 0; overflow: hidden; transition: max-height 0.4s cubic-bezier(.75,0,.32,1);
  background: inherit;
}
.cat.open .catContent { max-height: 800px; transition: max-height 0.5s cubic-bezier(.22,.68,.38,1.06);}
.items { display:flex; flex-wrap:wrap; gap: 13px 15px; margin:14px 10px 14px 20px; }
.item { 
  background: #fff; border-radius:6px; box-shadow:0 0 5px #0001; 
  width:145px; padding:8px; text-align:center; position:relative;
  transition:background 0.3s, color 0.3s, opacity .4s;
}
body.dark .item { background: #272a2f;}
.item img { width:74px; height:74px; object-fit:contain; }
.item .quantity { font-weight: bold; margin-top: 5px; }
.item.out-of-stock { opacity: 0.4; }
.checkbox-group { display:flex; flex-wrap:wrap; gap: 10px; margin:11px 0 17px 0;}
.checkbox-group label { display:flex; align-items:center; gap:5px;
  background:#eee; border-radius:7px; cursor:pointer; padding:5px 11px; transition: background .2s;
}
body.dark .checkbox-group label { background:#363a44; color:#fff;}
.checkbox-group input { cursor:pointer; }
</style>
</head>
<body>
<div id="loaderBg">
  <div class="loader"></div>
</div>
<div class="topbar">
  <h1>Grow a Garden Stock Monitor</h1>
  <div>
    <button class="toggle-btn" id="toggleNotif" title="Open Notifications">üîî</button>
    <button class="toggle-btn" onclick="toggleDark()" id="darkBtn" title="Dark mode">üåô</button>
  </div>
</div>
<div id="notifSide">
  <div id="notifSideHeader">
    <span style="font-size:1.2em;font-weight:600">Notifications</span>
    <button class="toggle-btn" onclick="toggleNotifMenu()" style="padding:3px 12px 1px;font-size:1.26em;">‚úñ</button>
  </div>
  <div id="notifItems"></div>
</div>
<div id="notifications" style="margin-bottom:15px; padding:12px 20px 2px 20px;">
  <div>
    <strong>Seeds:</strong>
    <div class="checkbox-group" id="seed-notifications"></div>
  </div>
  <div>
    <strong>Gears:</strong>
    <div class="checkbox-group" id="gear-notifications"></div>
  </div>
  <div>
    <strong>Eggs:</strong>
    <div class="checkbox-group" id="egg-notifications"></div>
  </div>
</div>
<div style="max-width: 850px; margin: 0 auto;">
  <div id="stock"></div>
</div>
<script>
const API_URL = 'https://api.joshlei.com/v2/growagarden/stock';
const API_KEY = 'js_c5d322d0652bc477f50348450bb2c6fe4f4d767042b2b0facb69b074c3d46f46';
// --- Define global item name lists ---
const SEEDS = /* ... */ ["Carrot", "Strawberry", "Blueberry", "Tomato", "Daffodil", "Watermelon", "Pumpkin", "Apple", "Bamboo", "Coconut", "Cactus", "Dragon Fruit", "Mango", "Grape", "Mushroom", "Pepper", "Cacao", "Beanstalk", "Ember lily", "Sugar Apple", "Burning Bud", "Giant Pinecone", "Elder Strawberry","Romanesco"];
const GEARS = /* ... */ ["Watering Can", "Trowel", "Recall Wrench", "Basic Sprinkler", "Advanced Sprinkler", "Medium Toy", "Medium Treat", "Godly Sprinkler", "Magnifying Glass", "Tanning Mirror", "Master Sprinkler", "Cleaning Spray", "Favorite Tool", "Harvest Tool", "Friendship Pot", "Levelup Lolipop"];
const EGGS = /* ... */ ["Common Egg", "Common Summer Egg", "Rare Summer Egg", "Mythical Egg", "Paradise Egg", "Bug Egg"];
// --- Local Storage ---
function saveNotifs() {
  localStorage.setItem('selectedNotifs', JSON.stringify(selectedNotifications));
}
function loadNotifs() {
  try { return JSON.parse(localStorage.getItem('selectedNotifs')) || {seeds:[],gears:[],eggs:[]}; } catch {return {seeds:[],gears:[],eggs:[]};}
}
function saveDark(on) { localStorage.setItem('dark', on ? '1' : '0'); }
function loadDark() { return localStorage.getItem('dark') ?? '1'; }
function saveAccordion(openCats) { localStorage.setItem('openCats', JSON.stringify(openCats)); }
function loadAccordion() {
  try { return JSON.parse(localStorage.getItem('openCats')) || {}; } catch { return {}; }
}
let selectedNotifications = loadNotifs();
let openCats = loadAccordion();
// --- Dark Mode ---
function setDark(on) {
  if (on) document.body.classList.add('dark');
  else document.body.classList.remove('dark');
  document.getElementById('darkBtn').textContent = on ? "‚òÄÔ∏è" : "üåô";
  saveDark(on);
}
function toggleDark() { setDark(!(document.body.classList.contains('dark'))); }
setDark(loadDark() === '1');
// --- Accordion ---
function toggleCat(catId) {
  openCats[catId] = !openCats[catId];
  saveAccordion(openCats);
  renderStock(window.lastStockData);
}
// --- Loader ---
function showLoader(on) {
  document.getElementById('loaderBg').style.display = on ? '' : 'none';
}
// --- Notifications Drawer ---
function toggleNotifMenu() {
  let drawer = document.getElementById('notifSide');
  drawer.classList.toggle('open');
}
document.getElementById('toggleNotif').onclick = toggleNotifMenu;
// --- Checkbox UI (Saved) ---
function makeCheckboxGroup(divId, names, key) {
  const target = document.getElementById(divId);
  target.innerHTML = '';
  names.forEach(name => {
    let label = document.createElement('label');
    let chk = document.createElement('input');
    chk.type = 'checkbox';
    chk.value = name;
    chk.checked = selectedNotifications[key].includes(name);
    chk.onchange = e => {
      let sel = selectedNotifications[key];
      if (e.target.checked) { if (!sel.includes(name)) sel.push(name); }
      else { selectedNotifications[key] = sel.filter(n => n !== name); }
      saveNotifs();
      renderNotifPanel(window.lastStockData);
    };
    label.appendChild(chk); label.appendChild(document.createTextNode(' '+name));
    target.appendChild(label);
  });
}
makeCheckboxGroup('seed-notifications', SEEDS, 'seeds');
makeCheckboxGroup('gear-notifications', GEARS, 'gears');
makeCheckboxGroup('egg-notifications', EGGS, 'eggs');
// -- Time Ago Utility --
function timeAgo(epoch) {
  if (!epoch) return '';
  let now = Date.now()/1000|0, diff = now-epoch;
  if (diff<60) return `${diff}s ago`;
  if (diff<3600) return `${(diff/60|0)}m ago`;
  if (diff<86400) return `${(diff/3600|0)}h ago`;
  return `${(diff/86400|0)}d ago`;
}
// --- Main Stock/UI Logic ---
async function fetchStock() {
  try {
    showLoader(true);
    const res = await fetch(API_URL, { headers: { 'accept': 'application/json', 'jstudio-key': API_KEY } });
    const data = await res.json();
    window.lastStockData = data;
    renderStock(data);
    renderNotifPanel(data);
  } finally { showLoader(false);}
}
function renderStock(data) {
  const categories = [
    { name:'Seeds', items: data.seed_stock, key: 'seeds' },
    { name:'Gears', items: data.gear_stock, key: 'gears' },
    { name:'Eggs', items: data.egg_stock, key: 'eggs' },
    { name:'Cosmetics', items: data.cosmetic_stock },
    { name:'Event Shop', items: data.eventshop_stock }
  ];
  const stockDiv = document.getElementById('stock');
  stockDiv.innerHTML = '';
  categories.forEach((cat, idx) => {
    if (!cat.items?.length) return;
    const catId = cat.name.toLowerCase().replace(/\s/g, '');
    const isOpen = !!openCats[catId];
    let catDiv = document.createElement('div');
    catDiv.className = 'cat'+(isOpen?' open':'');
    catDiv.innerHTML = `
      <div class="catHeader" onclick="toggleCat('${catId}')">${cat.name} <i>${isOpen?'‚ñ≤':'‚ñº'}</i></div>
      <div class="catContent"></div>
    `;
    let itemsDiv = catDiv.querySelector('.catContent');
    if (isOpen)
      itemsDiv.innerHTML = cat.items.map(item => `
        <div class="item${item.quantity===0?' out-of-stock':''}">
          <img src="${item.icon}" alt="${item.display_name}">
          <div>${item.display_name}</div>
          <div class="quantity">Qty: ${item.quantity}</div>
        </div>
      `).join('');
    stockDiv.appendChild(catDiv);
  });
}
// --- Notification Panel (side drawer) ---
function renderNotifPanel(data) {
  const notifCont = document.getElementById('notifItems');
  notifCont.innerHTML = '';
  if (!data) return;
  // Join selected items in all notif groups
  let allItems = [
    ...(data.seed_stock || []).filter(i=>selectedNotifications.seeds.includes(i.display_name)),
    ...(data.gear_stock || []).filter(i=>selectedNotifications.gears.includes(i.display_name)),
    ...(data.egg_stock || []).filter(i=>selectedNotifications.eggs.includes(i.display_name))
  ];
  // Want to attach "last seen"? Try requesting info endpoint if available
  allItems.forEach(async item => {
    const info = await fetch(
      `https://api.joshlei.com/v2/growagarden/info/${encodeURIComponent(item.display_name.toLowerCase().replace(/ /g,'_'))}`,
      { headers: { accept:'application/json','jstudio-key':API_KEY } }
    ).then(r=>r.ok?r.json():null).catch(()=>null);
    let lastSeen = info && info.last_seen ? timeAgo(info.last_seen) : '';
    let status = (item.quantity>0 ? '‚úîÔ∏è':'‚ùå');
    notifCont.innerHTML += `
      <div class="notifEntry">
        <img src="${item.icon}" alt="${item.display_name}">
        <span>${item.display_name}</span>
        <span class="notifStatus">${status}</span>
        <span class="notifLast">${lastSeen}</span>
      </div>
    `;
  });
}
// --- Start ---
fetchStock();
setInterval(fetchStock, 12000); // update every 12s
</script>
</body>
</html>
