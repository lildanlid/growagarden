<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grow a Garden Stock Monitor</title>
<style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; margin: 0; padding: 20px; }
    h1 { text-align: center; }
    .category { margin-bottom: 30px; }
    .category h2 { background: #474951; color: #fff; padding: 10px; border-radius: 5px; }
    .items { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
    .item { background: #fff; padding: 10px; border-radius: 5px; width: 150px; text-align: center; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    .item img { width: 80px; height: 80px; object-fit: contain; }
    .quantity { font-weight: bold; margin-top: 5px; }
</style>
</head>
<body>
<h1>Grow a Garden Stock Monitor</h1>

<div id="stock"></div>

<script>
const API_URL = 'https://api.joshlei.com/v2/growagarden/stock';
const API_KEY = 'js_c5d322d0652bc477f50348450bb2c6fe4f4d767042b2b0facb69b074c3d46f46';

const SEEDS = ["Carrot", "Strawberry", "Blueberry", "Tomato", "Daffodil", "Watermelon", "Pumpkin", "Apple", "Bamboo", "Coconut", "Cactus", "Dragon Fruit", "Mango", "Grape", "Mushroom", "Pepper", "Cacao", "Beanstalk", "Ember lily", "Sugar Apple", "Burning Bud", "Giant Pinecone", "Elder Strawberry","Romanesco"];
const GEARS = ["Watering Can", "Trowel", "Recall Wrench", "Basic Sprinkler", "Advanced Sprinkler", "Medium Toy", "Medium Treat", "Godly Sprinkler", "Magnifying Glass", "Tanning Mirror", "Master Sprinkler", "Cleaning Spray", "Favorite Tool", "Harvest Tool", "Friendship Pot", "Levelup Lolipop"];
const EGGS = ["Common Egg", "Common Summer Egg", "Rare Summer Egg", "Mythical Egg", "Paradise Egg", "Bug Egg"];

async function fetchStock() {
    try {
        const res = await fetch(API_URL, {
            headers: {
                'accept': 'application/json',
                'jstudio-key': API_KEY
            }
        });
        const data = await res.json();
        displayStock(data);
        checkNotifications(data);
    } catch (err) {
        console.error('Error fetching stock:', err);
    }
}

function displayStock(data) {
    const stockDiv = document.getElementById('stock');
    stockDiv.innerHTML = '';

    const categories = [
        {name: 'Seeds', items: data.seed_stock},
        {name: 'Gears', items: data.gear_stock},
        {name: 'Eggs', items: data.egg_stock},
        {name: 'Cosmetics', items: data.cosmetic_stock},
        {name: 'Event Shop', items: data.eventshop_stock}
    ];

    categories.forEach(cat => {
        const catDiv = document.createElement('div');
        catDiv.className = 'category';
        catDiv.innerHTML = `<h2>${cat.name}</h2>`;
        const itemsDiv = document.createElement('div');
        itemsDiv.className = 'items';

        cat.items.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item';
            itemDiv.innerHTML = `
                <img src="${item.icon}" alt="${item.display_name}">
                <div>${item.display_name}</div>
                <div class="quantity">Qty: ${item.quantity}</div>
            `;
            itemsDiv.appendChild(itemDiv);
        });

        catDiv.appendChild(itemsDiv);
        stockDiv.appendChild(catDiv);
    });
}

// Check for notifications
function checkNotifications(data) {
    const allItems = [...data.seed_stock, ...data.gear_stock, ...data.egg_stock];
    allItems.forEach(item => {
        if (SEEDS.includes(item.display_name) || GEARS.includes(item.display_name) || EGGS.includes(item.display_name)) {
            if (item.quantity > 0) {
                notify(item.display_name, item.quantity);
            }
        }
    });
}

// Browser notification
function notify(name, qty) {
    if (!("Notification" in window)) return;
    if (Notification.permission === "granted") {
        new Notification(`${name} in stock!`, { body: `Quantity: ${qty}` });
    } else if (Notification.permission !== "denied") {
        Notification.requestPermission().then(permission => {
            if (permission === "granted") {
                new Notification(`${name} in stock!`, { body: `Quantity: ${qty}` });
            }
        });
    }
}

// Refresh every 30 seconds
fetchStock();
setInterval(fetchStock, 995);
</script>
</body>
</html>
