<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Grow a Garden Notifier</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Material+Symbols+Rounded" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body{background:linear-gradient(180deg,#242a43 0%,#232a45 25%,#2e3453 60%,#384063 100%)}
    .item-icon img,.weather-icon img{background:transparent!important;border-radius:0!important;box-shadow:none!important;width:56px;height:56px;object-fit:contain}
    .star-btn .material-symbols-rounded{font-size:2.2em;color:#b6caf7}
    .star-btn.starred .material-symbols-rounded{color:#ffe066}
    .star-corner{position:absolute;top:.7rem;right:.7rem;z-index:2;background:transparent;border-radius:50%;border:none}
    .item-card{position:relative;overflow:visible;transition:box-shadow .16s,background .18s}
    .item-card:hover{box-shadow:0 0 0 2px #2ec6fa33}
    .hover-effect,button,.category-tab,.star-btn,.modal-unotify-btn{transition:background .2s,color .2s,transform .15s,box-shadow .2s}
    .hover-effect:hover,button:hover,.category-tab:hover,.star-btn:hover,.modal-unotify-btn:hover{background:#353c5c!important;color:#8ec4ff!important;transform:translateY(-2px) scale(1.05);box-shadow:0 0 0 2px #2ec6fa33}
    .settings-btn:hover .material-symbols-rounded{transform:rotate(40deg) scale(1.15);color:#2ec6fa;transition:.2s}
    .settings-modal-bg{background:rgba(30,40,70,0.75);backdrop-filter:blur(2px)}
    ::-webkit-scrollbar{width:5px;background:#222845}
    ::-webkit-scrollbar-thumb{background:#39507a;border-radius:8px}
    .item-card.weather-active { background-color: #1e4fae !important; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center font-inter">
  <div class="bg-transparent border border-[#464f63] rounded-xl p-5 w-[98vw] max-w-[1200px] min-h-[95vh] flex flex-col relative justify-start" style="box-shadow:0 4px 34px #10193377;">
    <div class="flex items-center justify-end w-full">
      <button id="settingsBtn" class="settings-btn mr-2 p-1 rounded-full hover:bg-[#353c5c] transition hover-effect focus:outline-none" aria-label="Settings" title="Settings">
        <span class="material-symbols-rounded text-2xl text-[#8ec4ff]">settings</span>
      </button>
      <span id="lastUpdated" class="text-xs text-[#8ec4ff] select-none"></span>
    </div>
    <div class="flex flex-row gap-3 mt-3 mb-4">
      <button class="category-tab hover-effect flex items-center gap-2 px-6 py-2 rounded-lg font-semibold text-[#b6caf7] bg-[#232a45]" data-tab="seeds"><span class="material-symbols-rounded text-lg align-middle">eco</span>Seeds</button>
      <button class="category-tab hover-effect flex items-center gap-2 px-6 py-2 rounded-lg font-semibold text-[#b6caf7] bg-[#232a45]" data-tab="gear"><span class="material-symbols-rounded text-lg align-middle">build</span>Gear</button>
      <button class="category-tab hover-effect flex items-center gap-2 px-6 py-2 rounded-lg font-semibold text-[#b6caf7] bg-[#232a45]" data-tab="eggs"><span class="material-symbols-rounded text-lg align-middle">egg</span>Eggs</button>
      <button class="category-tab hover-effect flex items-center gap-2 px-6 py-2 rounded-lg font-semibold text-[#b6caf7] bg-[#232a45]" data-tab="weather"><span class="material-symbols-rounded text-lg align-middle">cloud</span>Weather</button>
      <button class="category-tab hover-effect flex items-center gap-2 px-6 py-2 rounded-lg font-semibold text-[#b6caf7] bg-[#232a45]" data-tab="cosmetics"><span class="material-symbols-rounded text-lg align-middle">auto_awesome</span>Cosmetics</button>
    </div>
    <div class="flex items-center gap-4 bg-[#232a45] rounded-lg px-6 py-4 mb-6 border border-[#394464]">
      <span class="material-symbols-rounded text-[#b6caf7] mr-2 text-xl">schedule</span>
      <span class="font-semibold text-white mr-4 select-none" id="restockLabel">Seeds Restock:</span>
      <span class="text-[#2ec6fa] font-bold" id="restockTimerBar">01m 38s</span>
      <span class="ml-auto text-xs text-[#b6caf7] select-none">Updated:<span id="restockAgo" class="ml-1"></span></span>
    </div>
    <div id="cosmeticsStocksNote" class="mb-4 text-blue-300 font-semibold hidden">Only Showing Stocks</div>
    <div class="item-list grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-5" id="itemList"></div>
    <div id="settingsModalBg" class="fixed inset-0 hidden z-50 settings-modal-bg flex items-center justify-center">
      <div class="bg-[#222845] border border-[#464f63] rounded-xl p-6 w-full max-w-xs relative">
        <h2 class="font-semibold text-lg text-[#8ec4ff] mb-4">Settings</h2>
        <div class="mb-2 flex gap-2 items-center">
          <input id="toggleStockText" type="checkbox" class="toggle-checkbox rounded accent-[#2ec6fa]" checked>
          <label for="toggleStockText" class="text-[#b6caf7] font-medium">Show stock count</label>
        </div>
        <div class="mb-2 flex gap-2 items-center">
          <input id="toggleActiveText" type="checkbox" class="toggle-checkbox rounded accent-[#2ec6fa]" checked>
          <label for="toggleActiveText" class="text-[#b6caf7] font-medium">Show "Active" text</label>
        </div>
        <div class="mb-4 flex gap-2 items-center">
          <input id="toggleNameText" type="checkbox" class="toggle-checkbox rounded accent-[#2ec6fa]" checked>
          <label for="toggleNameText" class="text-[#b6caf7] font-medium">Show Item Name</label>
        </div>
        <button id="closeSettingsBtn" class="hover-effect bg-[#353c5c] px-4 py-2 rounded-lg text-[#8ec4ff] font-semibold w-full mt-2">Close</button>
      </div>
    </div>

    <footer class="w-full text-center mt-6 text-xs text-[#8ec4ff] opacity-80 select-none">
      &copy; <span id="copyright-year"></span> <span id="copyright-owner">lildanlid</span> - MIT License
    </footer>
  </div>
  <script>

    (function(){
      var owner = document.getElementById("copyright-owner");
      if(!owner || !/lildanlid/i.test(owner.textContent)) {
        document.body.innerHTML = "<h1 style='color:red;text-align:center;font-size:2em;margin-top:10vh'>This site is not licensed for use without lildanlid attribution.</h1>";
        throw new Error("Missing copyright attribution: lildanlid");
      }
      document.getElementById("copyright-year").textContent = new Date().getFullYear();
    })();

    let notificationEnabled = false, notifyList = [], notifiedItems = {};
    function requestNotificationPermission() {
      if (window.Notification && Notification.permission !== "granted") {
        Notification.requestPermission().then(function (e) {
          notificationEnabled = "granted" === e
        })
      } else {
        notificationEnabled = window.Notification && "granted" === Notification.permission
      }
    }
    function sendNotification(item, options = {}) {
      if (!notificationEnabled) return;
 
      let key = options.type === "weather"
        ? "weather-" + item.weather_name
        : item.display_name + "-" + (item.item_id || "");

      if (notifiedItems[key]) return;
      notifiedItems[key] = true;
      let title = options.type === "weather"
        ? (item.weather_name || "Weather") + " is now active!"
        : (item.display_name || "Item") + " is in stock!";
      let body = options.type === "weather"
        ? (item.weather_name + " is now happening in Grow a Garden!")
        : ("Quantity: " + item.quantity);
      let icon = item.icon || "";
      new Notification(title, { body, icon });
    }
    function saveSettings() {
      localStorage.setItem("showStockText", showStockText ? "1" : "0");
      localStorage.setItem("showActiveText", showActiveText ? "1" : "0");
      localStorage.setItem("showNameText", showNameText ? "1" : "0");
      localStorage.setItem("notifyList", JSON.stringify(notifyList));
      localStorage.setItem("currentTab", currentTab);
    }
    function loadSettings() {
      if (null !== localStorage.getItem("showStockText")) showStockText = "1" === localStorage.getItem("showStockText");
      if (null !== localStorage.getItem("showActiveText")) showActiveText = "1" === localStorage.getItem("showActiveText");
      if (null !== localStorage.getItem("showNameText")) showNameText = "1" === localStorage.getItem("showNameText");
      if (null !== localStorage.getItem("notifyList")) notifyList = JSON.parse(localStorage.getItem("notifyList"));
      if (localStorage.getItem("currentTab")) currentTab = localStorage.getItem("currentTab");
    }
    const IMAGE_OVERRIDES = {
      "Summer Common Egg": "common_summer_egg",
      "Rare Summer Egg": "rare_summer_egg",
      "Paradise Egg": "paradise_egg",
      "Legendary Egg": "legendary_egg",
      "Uncommon Egg": "uncommon_egg",
      "Prickly pear": "prickly_pear",
      "Prikily pear": "prickly_pear"
    };
    const SEED_NAMES = ["Carrot", "Strawberry", "Blueberry", "Tomato", "Cauliflower", "Watermelon", "Green apple", "Avocado", "Banana", "Pineapple", "Kiwi", "Bell pepper", "Prickly pear", "Loquat", "Feijoa", "Sugar Apple"];
    const GEAR_NAMES = ["Watering Can", "Trowel", "Recall Wrench", "Basic Sprinkler", "Advanced Sprinkler", "Godly Sprinkler", "Tanning Mirror", "Master Sprinkler", "Cleaning Spray", "Favorite Tool", "Harvest Tool", "Friendship Pot"];
    const EGG_NAMES = ["Summer Common Egg", "Rare Summer Egg", "Common Egg", "Uncommon Egg", "Rare Egg", "Paradise Egg", "Legendary Egg", "Mythical Egg", "Bug Egg"];
    let stockData = {}, itemInfoData = {}, weatherData = [], currentTab = "seeds", showStockText = true, showActiveText = true, showNameText = true, loadedTab = {}, lastRestockZero = { seeds: 0, gear: 0, eggs: 0, cosmetic: 0, weather: 0 };

    function pad(e) { return e < 10 ? "0" + e : e }
    function calculateRestockTimes() {
      const now = new Date();
      const timezone = 'America/New_York';
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      function formatTime(timestamp) {
        return new Date(timestamp).toLocaleString('en-US', {
          hour: 'numeric',
          minute: '2-digit',
          hour12: true,
          timeZone: timezone
        });
      }
      function timeSince(timestamp) {
        const nowMs = Date.now();
        const diff = nowMs - timestamp;
        const seconds = Math.floor(diff / 1000);
        if (seconds < 60) return `${seconds}s ago`;
        const minutes = Math.floor(seconds / 60);
        if (minutes < 60) return `${minutes}m ago`;
        const hours = Math.floor(minutes / 60);
        return `${hours}h ago`;
      }
      function getResetTimes(interval) {
        const timeSinceStartOfDay = now.getTime() - today.getTime();
        const lastReset = today.getTime() + Math.floor(timeSinceStartOfDay / interval) * interval;
        const nextReset = today.getTime() + Math.ceil(timeSinceStartOfDay / interval) * interval;
        return { lastReset, nextReset };
      }
      const eggInterval = 30 * 60 * 1000;
      const { lastReset: eggLastReset, nextReset: eggNextReset } = getResetTimes(eggInterval);
      const eggCountdownMs = eggNextReset - now.getTime();
      const eggCountdown = `${pad(Math.floor(eggCountdownMs / 6e4))}m ${pad(Math.floor((eggCountdownMs % 6e4) / 1e3))}s`;
      const gearInterval = 5 * 60 * 1000;
      const { lastReset: gearLastReset, nextReset: gearNextReset } = getResetTimes(gearInterval);
      const gearCountdownMs = gearNextReset - now.getTime();
      const gearCountdown = `${pad(Math.floor(gearCountdownMs / 6e4))}m ${pad(Math.floor((gearCountdownMs % 6e4) / 1e3))}s`;
      const cosmeticInterval = 4 * 3600 * 1000;
      const { lastReset: cosmeticLastReset, nextReset: cosmeticNextReset } = getResetTimes(cosmeticInterval);
      const cosmeticCountdownMs = cosmeticNextReset - now.getTime();
      const cosmeticCountdown = `${pad(Math.floor(cosmeticCountdownMs / 36e5))}h ${pad(Math.floor((cosmeticCountdownMs % 36e5) / 6e4))}m ${pad(Math.floor((cosmeticCountdownMs % 6e4) / 1e3))}s`;
      const nightInterval = 3600 * 1000;
      const { lastReset: nightLastReset, nextReset: nightNextReset } = getResetTimes(nightInterval);
      const nightCountdownMs = nightNextReset - now.getTime();
      const nightCountdown = `${pad(Math.floor(nightCountdownMs / 36e5))}h ${pad(Math.floor((nightCountdownMs % 36e5) / 6e4))}m ${pad(Math.floor((nightCountdownMs % 6e4) / 1e3))}s`;
      return {
        egg: {
          timestamp: eggNextReset,
          countdown: eggCountdown,
          LastRestock: formatTime(eggLastReset),
          timeSinceLastRestock: timeSince(eggLastReset),
          ms: eggCountdownMs
        },
        gear: {
          timestamp: gearNextReset,
          countdown: gearCountdown,
          LastRestock: formatTime(gearLastReset),
          timeSinceLastRestock: timeSince(gearLastReset),
          ms: gearCountdownMs
        },
        seeds: {
          timestamp: gearNextReset,
          countdown: gearCountdown,
          LastRestock: formatTime(gearLastReset),
          timeSinceLastRestock: timeSince(gearLastReset),
          ms: gearCountdownMs
        },
        cosmetic: {
          timestamp: cosmeticNextReset,
          countdown: cosmeticCountdown,
          LastRestock: formatTime(cosmeticLastReset),
          timeSinceLastRestock: timeSince(cosmeticLastReset),
          ms: cosmeticCountdownMs
        },
        SwarmEvent: {
          timestamp: nightNextReset,
          countdown: nightCountdown,
          LastRestock: formatTime(nightLastReset),
          timeSinceLastRestock: timeSince(nightLastReset),
          ms: nightCountdownMs
        }
      };
    }
    function getRestockCategoryForTab(tab) {
      if (tab === "seeds") return "seeds";
      if (tab === "gear") return "gear";
      if (tab === "eggs") return "egg";
      if (tab === "weather") return "SwarmEvent";
      if (tab === "cosmetics") return "cosmetic";
      return null;
    }
    function getRestockLabel(tab) {
      if (tab === "seeds") return "Seeds Restock";
      if (tab === "gear") return "Gear Restock";
      if (tab === "eggs") return "Eggs Restock";
      if (tab === "cosmetics") return "Cosmetics Restock";
      return "";
    }
    function updateRestockBar() {
      const restockData = calculateRestockTimes(),
        cat = getRestockCategoryForTab(currentTab),
        timerBar = document.getElementById("restockTimerBar"),
        restockAgo = document.getElementById("restockAgo"),
        restockLabel = document.getElementById("restockLabel");
      restockLabel.textContent = getRestockLabel(currentTab) + ":";
      if (!cat || !restockData[cat]) {
        timerBar.textContent = "No restock data available.";
        restockAgo.textContent = "";
        return
      }
      timerBar.textContent = restockData[cat].countdown ?? "No restock data available.";
      restockAgo.textContent = restockData[cat].timeSinceLastRestock ?? "";
      if (restockData[cat].ms < 1200 && restockData[cat].ms >= 0 && (!lastRestockZero[cat] || Date.now() - lastRestockZero[cat] > 4000)) {
        lastRestockZero[cat] = Date.now();
        if (currentTab === "weather") fetchWeather(true, true); else fetchStock(true, true)
      }
    }
    function fetchStock(e = false, t = false) {
      fetch("https://api.joshlei.com/v2/growagarden/stock", { cache: "reload" })
        .then(e => e.ok ? e.json() : {})
        .then(e => {
          stockData = e || {};
          loadedTab.seeds = loadedTab.gear = loadedTab.eggs = loadedTab.cosmetics = true;
          ["seeds", "gear", "eggs", "cosmetics"].includes(currentTab) && renderList(currentTab);
          checkNotify(stockData)
        })
    }
    function fetchInfo() {
      fetch("https://api.joshlei.com/v2/growagarden/info", { cache: "reload" })
        .then(e => e.ok ? e.json() : {})
        .then(e => { itemInfoData = e || {} })
    }
    function fetchWeather(e = false, t = false) {
      fetch("https://api.joshlei.com/v2/growagarden/weather", { cache: "reload" })
        .then(e => e.ok ? e.json() : { weather: [] })
        .then(e => {
          weatherData = e.weather || [];
          loadedTab.weather = true;
          if (currentTab === "weather") renderWeatherList();
          checkWeatherNotify(weatherData);
        })
    }
    function getImageId(e) {
      return IMAGE_OVERRIDES[e] || e.toLowerCase().replace(/ /g, "_").replace("prikily_pear", "prickly_pear").replace("summer_rare_egg", "rare_summer_egg")
    }

    function renderList(tab) {
      if (tab === "cosmetics") document.getElementById("cosmeticsStocksNote").classList.remove("hidden");
      else document.getElementById("cosmeticsStocksNote").classList.add("hidden");
      document.getElementById("itemList").innerHTML = "";
      let items = [];
      if (tab === "cosmetics") {
        items = (stockData.cosmetic_stock || []).filter(e => e.quantity > 0)
      } else if (tab === "seeds") {
        items = SEED_NAMES.map(name => {
          let stock = (stockData.seed_stock || []).find(e => e.display_name === name),
            item_id = getImageId(name);
          return stock || { display_name: name, item_id: item_id, quantity: 0, icon: `https://api.joshlei.com/v2/growagarden/image/${item_id}` }
        })
      } else if (tab === "gear") {
        items = GEAR_NAMES.map(name => {
          let stock = (stockData.gear_stock || []).find(e => e.display_name === name),
            item_id = getImageId(name);
          return stock || { display_name: name, item_id: item_id, quantity: 0, icon: `https://api.joshlei.com/v2/growagarden/image/${item_id}` }
        })
      } else if (tab === "eggs") {
        items = EGG_NAMES.map(name => {
          let item_id = getImageId(name),
            stock = (stockData.egg_stock || []).find(e => e.display_name === name) || (stockData.egg_stock || []).find(e => e.item_id === item_id);
          return stock || { display_name: name, item_id: item_id, quantity: 0, icon: `https://api.joshlei.com/v2/growagarden/image/${item_id}` }
        })
      } else if (tab === "weather") {
        renderWeatherList();
        return
      }
      if (items.length === 0) {
        document.getElementById("itemList").innerHTML = '<div class="text-yellow-400 text-center py-8">No items in stock.</div>';
        return
      }
      items.forEach(function (item) {
        let card = document.createElement("div");
        card.className = `item-card border relative flex flex-col items-center py-7 px-4 rounded-xl shadow ${notifyList.includes(item.display_name) ? "border-2 border-[#2ec6fa]" : "border-[#394464]"} ${item.quantity > 0 ? "bg-green-900/60" : "bg-[#232a45]/80"}`;
        if (tab !== "cosmetics") {
          const btnCol = document.createElement("button");
          btnCol.className = `star-btn star-corner hover-effect rounded-full p-0 m-0 ${notifyList.includes(item.display_name) ? "starred" : ""}`;
          btnCol.title = notifyList.includes(item.display_name) ? "UnNotify" : "Notify";
          btnCol.innerHTML = `<span class="material-symbols-rounded align-middle">${notifyList.includes(item.display_name) ? "star" : "star"}</span>`;
          btnCol.onclick = r => {
            r.stopPropagation();
            if (notifyList.includes(item.display_name)) notifyList = notifyList.filter(t => t !== item.display_name);
            else notifyList.push(item.display_name);
            saveSettings();
            renderList(currentTab)
          };
          card.appendChild(btnCol)
        }
        const iconDiv = document.createElement("div");
        iconDiv.className = "item-icon bg-transparent w-14 h-14 flex items-center justify-center mb-4";
        let iconSrc = item.icon;
        if (iconSrc) {
          const img = document.createElement("img");
          img.src = iconSrc;
          img.alt = item.display_name;
          img.draggable = false;
          img.className = "w-14 h-14 object-contain";
          img.onerror = function () {
            if (this._triedLower) this.style.display = "none";
            else {
              this._triedLower = true;
              this.src = `https://api.joshlei.com/v2/growagarden/image/${getImageId(item.display_name)}`
            }
          };
          iconDiv.appendChild(img)
        } else iconDiv.textContent = (item.display_name || "-").split(" ").map(e => e[0]).join("").toUpperCase().slice(0, 2);
        card.appendChild(iconDiv);
        if (showNameText) {
          const nameDiv = document.createElement("div");
          nameDiv.className = "item-name font-semibold text-white text-[1.1em] text-center";
          nameDiv.textContent = item.display_name;
          card.appendChild(nameDiv)
        }
        if (showStockText) {
          const badge = document.createElement("div");
          badge.className = "mt-2 mb-0.5 in-stock-badge font-bold text-lg text-center w-max mx-auto";
          badge.style.color = item.quantity > 0 ? "#3cf79b" : "#aaa";
          badge.textContent = item.quantity;
          card.appendChild(badge)
        }
        document.getElementById("itemList").appendChild(card)
      })
    }

    function renderWeatherList() {
      document.getElementById("cosmeticsStocksNote").classList.add("hidden");
      const itemListEl = document.getElementById("itemList");
      itemListEl.innerHTML = "";
      if (!weatherData || !Array.isArray(weatherData) || weatherData.length === 0) {
        itemListEl.innerHTML = '<div class="text-yellow-400 text-center py-8">No weather data found.</div>';
        return
      }
      weatherData.forEach(function (weather) {
        const card = document.createElement("div");
        let cardClasses = `item-card border relative flex flex-col items-center py-7 px-4 rounded-xl shadow ${notifyList.includes(weather.weather_name) ? "border-2 border-[#2ec6fa]" : "border-[#394464]"} `;
        if (weather.active) cardClasses += "weather-active ";
        else cardClasses += "bg-[#232a45]/80 ";
        card.className = cardClasses;

        const btnCol = document.createElement("button");
        btnCol.className = `star-btn star-corner hover-effect rounded-full p-0 m-0 ${notifyList.includes(weather.weather_name) ? "starred" : ""}`;
        btnCol.title = notifyList.includes(weather.weather_name) ? "UnNotify" : "Notify";
        btnCol.innerHTML = `<span class="material-symbols-rounded align-middle">${notifyList.includes(weather.weather_name) ? "star" : "star"}</span>`;
        btnCol.onclick = i => {
          i.stopPropagation();
          if (notifyList.includes(weather.weather_name)) notifyList = notifyList.filter(e => e !== weather.weather_name);
          else notifyList.push(weather.weather_name);
          saveSettings();
          renderWeatherList()
        };
        card.appendChild(btnCol);

        const iconDiv = document.createElement("div");
        iconDiv.className = "weather-icon bg-transparent w-14 h-14 flex items-center justify-center mb-4";
        let iconSrc = weather.icon;
        if (iconSrc) {
          const img = document.createElement("img");
          img.src = iconSrc;
          img.alt = weather.weather_name;
          img.draggable = false;
          img.className = "w-14 h-14 object-contain";
          img.onerror = function () {
            if (this._triedLower) this.style.display = "none";
            else {
              this._triedLower = true;
              this.src = `https://api.joshlei.com/v2/growagarden/image/${getImageId(weather.weather_name)}`
            }
          };
          iconDiv.appendChild(img)
        }
        card.appendChild(iconDiv);
        if (showNameText) {
          const nameDiv = document.createElement("div");
          nameDiv.className = "item-name font-semibold text-white text-[1.1em] text-center";
          nameDiv.textContent = weather.weather_name;
          card.appendChild(nameDiv)
        }
        if (weather.active && showActiveText) {
          const badge = document.createElement("div");
          badge.className = "mt-2 mb-0.5 active-badge bg-[#2ec6fa] text-white rounded px-2 py-0.5 text-sm font-semibold text-center w-max mx-auto";
          badge.textContent = "Active";
          card.appendChild(badge)
        }
        itemListEl.appendChild(card)
      })
    }

    function checkNotify(stockData) {
      let t = [...(stockData.seed_stock || []), ...(stockData.gear_stock || []), ...(stockData.egg_stock || [])], a = {};
      for (const n of t) {
        let key = `${n.display_name}-${n.item_id}`;
        if (notifyList.includes(n.display_name) && n.quantity > 0 && !a[key]) {
          sendNotification(n, { type: "stock" });
          a[key] = true;
        }
        else if (n.quantity <= 0) notifiedItems[key] = false;
      }
    }

    function checkWeatherNotify(weatherData) {
      if (!Array.isArray(weatherData)) return;
      for (const weather of weatherData) {
        let key = "weather-" + weather.weather_name;
        if (notifyList.includes(weather.weather_name) && weather.active && !notifiedItems[key]) {
          sendNotification(weather, { type: "weather" });
          notifiedItems[key] = true;
        } else if (!weather.active) {
          notifiedItems[key] = false;
        }
      }
    }

    function setActiveTab(e) {
      document.querySelectorAll(".category-tab").forEach(t => {
        t.classList.toggle("bg-[#464f88]", t.dataset.tab === e);
        t.classList.toggle("bg-[#232a45]", t.dataset.tab !== e);
        t.classList.toggle("text-white", t.dataset.tab === e);
        t.classList.toggle("text-[#b6caf7]", t.dataset.tab !== e)
      });
      currentTab = e;
      saveSettings();
      loadedTab[e] ? ("weather" === e ? renderWeatherList() : renderList(e)) : ("weather" === e ? fetchWeather() : fetchStock());
      updateRestockBar()
    }
    document.addEventListener("DOMContentLoaded", function () {
      loadSettings();
      document.getElementById("toggleStockText").checked = showStockText;
      document.getElementById("toggleActiveText").checked = showActiveText;
      document.getElementById("toggleNameText").checked = showNameText;
      document.getElementById("settingsBtn").onclick = () => document.getElementById("settingsModalBg").classList.remove("hidden");
      document.getElementById("closeSettingsBtn").onclick = () => document.getElementById("settingsModalBg").classList.add("hidden");
      document.getElementById("settingsModalBg").onclick = e => { if (e.target === document.getElementById("settingsModalBg")) document.getElementById("settingsModalBg").classList.add("hidden") };
      document.getElementById("toggleStockText").onchange = function () { showStockText = this.checked; saveSettings(); renderList(currentTab) };
      document.getElementById("toggleActiveText").onchange = function () { showActiveText = this.checked; saveSettings(); renderList(currentTab) };
      document.getElementById("toggleNameText").onchange = function () { showNameText = this.checked; saveSettings(); renderList(currentTab) };
      document.querySelectorAll(".category-tab").forEach(e => e.addEventListener("click", t => setActiveTab(e.dataset.tab)));
      requestNotificationPermission();
      renderList(currentTab);
      fetchStock();
      fetchWeather();
      fetchInfo();
      setInterval(updateRestockBar, 1000);
      setInterval(() => {
        document.getElementById("lastUpdated").textContent = "Updated: " + new Date().toLocaleTimeString([], { hour: "2-digit", minute: "2-digit", second: "2-digit" })
      }, 5000);
      document.getElementById("lastUpdated").textContent = "Updated: " + new Date().toLocaleTimeString([], { hour: "2-digit", minute: "2-digit", second: "2-digit" });
      updateRestockBar();
      setInterval(() => { "weather" === currentTab ? fetchWeather(false, true) : fetchStock(false, true) }, 3000);
      setTimeout(() => { setActiveTab(currentTab) }, 0)
    });
  </script>
</body>
</html>
